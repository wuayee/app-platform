<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>dynamicForm-Demo</title>
    <style>
    </style>

    <script type="module">
        import {FORM} from "./formEntry.js";
        import {PAGE_MODE} from "../../common/const.js";

        const graphId = "dynamic-form-demo graph";
        window.onload = async () => {
            document.getElementById("fileDownload").addEventListener("click", () => {
                window.agent.want("htmlFileDownload");
            });

            document.getElementById("confirmButton").addEventListener("click", () => {
                window.agent.want("confirmButton");
            });

            document.getElementById("fillDataToFileDownload").addEventListener("click", () => {
                const fileDownload = window.runAgent.graph.activePage.shapes.find(s => s.type === "htmlFileDownload");
                if (fileDownload) {
                    fileDownload.componentId = "fileDownload_1";
                    const data = {};
                    data[fileDownload.componentId] = [
                        {fileName: "DME Storage  2.0.0 技术白皮书 01 (1).pdf", fileUrl: "aHR0cDovLzEwLjkxLjE1OS4xMTc6MTI3NTEveGlhb2hhaS9maWxlP2ZpbGVQYXRoPSUyRmhvbWUlMkZ4emolMkZkYWhhaV9maWxlX3NlcnZlciUyRmZpbGUlMkZETVMlMkZETUUrU3RvcmFnZSsrMi4wLjArJUU2JThBJTgwJUU2JTlDJUFGJUU3JTk5JUJEJUU3JTlBJUFFJUU0JUI5JUE2KzAxLnBkZiZpc09uTGluZT1mYWxzZQ=="},
                        {fileName: "xvxcvxcv.doc", fileUrl: "aHR0cDovLzEwLjkxLjE1OS4xMTc6MTI3NTEveGlhb2hhaS9maWxlP2ZpbGVQYXRoPSUyRmhvbWUlMkZ4emolMkZkYWhhaV9maWxlX3NlcnZlciUyRmZpbGUlMkZETVMlMkZETUUrU3RvcmFnZSsrMi4wLjArJUU2JThBJTgwJUU2JTlDJUFGJUU3JTk5JUJEJUU3JTlBJUFFJUU0JUI5JUE2KzAxLnBkZiZpc09uTGluZT1mYWxzZQ=="}
                    ];
                    fileDownload.formDataRetrieved(null, data);
                }
            });

            document.getElementById("configForm").addEventListener("click", () => {
                FORM.new(document.getElementById("main")).then(agent => {
                    window.agent = agent;
                    // window.agent.want("htmlImageInput");
                    // window.agent.want("htmlButton");
                });
            });

            document.getElementById("serialize").addEventListener("click", () => {
                window.sheetConfigData = window.agent.serialize();
            });

            document.getElementById("run").addEventListener("click", () => {
                FORM.run(document.getElementById("runMain"), window.sheetConfigData, PAGE_MODE.RUNTIME)
                    .initializeData({
                        aippId: "123", aippInstanceId: "22334", tenantId: "123123123", protocol: "http", domains: {
                            // jane: "jane-alpha.huawei.com",
                            jane: "10.25.192.138:8028",
                            elsa: "fit-elsa-alpha.lab.huawei.com/elsa-backend",
                            llm: "tzaip-beta.paas.huawei.com"
                        }
                    })
                    .submitted(() => {
                        console.log("123");
                    })
                    .onSubmit(() => {
                        console.log("onSubmit");
                    })
                    .then(agent => {
                        window.runAgent = agent;
                    });
            });

            document.getElementById("history").addEventListener("click", () => {
                FORM.run(document.getElementById("runMain"), window.sheetConfigData, PAGE_MODE.HISTORY)
                    .initializeData({
                        aippId: "123", aippInstanceId: "22334", tenantId: "123123123", protocol: "http", domains: {
                            // jane: "jane-alpha.huawei.com",
                            jane: "10.25.192.138:8028",
                            elsa: "fit-elsa-alpha.lab.huawei.com/elsa-backend",
                            llm: "tzaip-beta.paas.huawei.com"
                        }
                    })
                    .submitted(() => {
                        console.log("123");
                    })
                    .onSubmit(() => {
                        console.log("onSubmit");
                    })
                    .then(agent => {
                        window.historyAgent = agent;
                    });
            });

            document.getElementById("loadForm").addEventListener("click", () => {
                const root = document.getElementById("root");

                const divider = document.createElement("div");
                divider.style.height = "100px";
                root.appendChild(divider);

                const pageDom = document.createElement("div");
                pageDom.style.width = "800px";
                pageDom.style.height = "400px";
                pageDom.style.position = "relative";
                root.appendChild(pageDom);

                window.historyAgent.loadFormFromGraph(window.sheetConfigData, pageDom, PAGE_MODE.HISTORY);
            });
        };
    </script>
</head>

<body>
<div>
    <button id="fileDownload">fileDownload</button>
    <button id="confirmButton">confirmButton</button>
    <button id="configForm">configForm</button>
    <button id="serialize">Serialize</button>
    <button id="run">run</button>
    <button id="history">history</button>
    <button id="fillDataToFileDownload">fillDataToFileDownload</button>
    <button id="loadForm">loadForm</button>
</div>
<div id="root" style="background: #2f90ff">
    <div id="main" style="width:800px; height: 200px;position: relative"></div>
    <div style="height: 100px"></div>
    <div id="runMain" style="width:800px; height: 200px;position: relative"></div>
</div>
</body>

</html>