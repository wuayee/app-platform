<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>elsa</title>

    <script type="module" language="javascript">
        import {ELSA} from "../../core/elsaEntry.js";
        import {getUrlParam} from "../../common/util.js";

        var p = null;

        window.onload = () => {
            ELSA.newGraph()
                .then(id => ELSA.editGraph(id, document.getElementById("main")))
                .then(g => {
                    function draw(x, y) {
                        const line = p.createNew("freeLine", 0, 0);
                        line.resize(p.width, p.height)
                        line.addPoint(x + 10, y + 10);
                        line.addPoint(x + 20, y + 10);
                        line.addPoint(x + 30, y + 10);
                        line.done();

                        const line2 = p.createNew("freeLine", 0, 0);
                        line2.resize(p.width, p.height)
                        line2.addPoint(x + 20, y + 10);
                        line2.addPoint(x + 20, y + 20);
                        line2.addPoint(x + 20, y + 30);
                        line2.done();

                        const line3 = p.createNew("freeLine", 0, 0);
                        line3.resize(p.width, p.height)
                        line3.addPoint(x + 20, y + 20);
                        line3.addPoint(x + 25, y + 20);
                        line3.addPoint(x + 28, y + 20);
                        line3.done();

                        const line4 = p.createNew("freeLine", 0, 0);
                        line4.resize(p.width, p.height)
                        line4.addPoint(x + 14, y + 20);
                        line4.addPoint(x + 14, y + 25);
                        line4.addPoint(x + 14, y + 30);
                        line4.done();

                        const line5 = p.createNew("freeLine", 0, 0);
                        line5.resize(p.width, p.height)
                        line5.addPoint(x + 10, y + 30);
                        line5.addPoint(x + 20, y + 30);
                        line5.addPoint(x + 30, y + 30);
                        line5.done();
                    }

                    let total = getUrlParam("num");
                    let centerX = getUrlParam("cx");
                    let centerY = getUrlParam("cy");

                    p = g.addPage();

                    for (let i = 0; i < 20; ++i) {
                        for (let j = 0; j < total / 20; ++j) {
                            draw(i * 50, j * 50);
                        }
                    }

                    window.Interact = {};

                    window.Interact.zoomIn = () => {
                        p.zoom(0.1, centerX, centerY);
                    }

                    window.Interact.zoomOut = () => {
                        p.zoom(-0.1, centerX, centerY);
                    }

                    window.Interact.zoom = (scale) => {
                        p.zoom(scale - p.scaleX, centerX, centerY);
                    }

                    window.Interact.move = (x, y) => {
                        p.moveTo(p.x + x, p.y + y);
                    }

                    p.reset();
                    p.startAnimation();
                    // p.wantedShape = "rectangle";
                });
        }

    </script>

</head>

<body>
<div id="main" style="width:1400px; height: 900px;position: absolute;"></div>
<!-- <div id="point" style="width:6px; height: 6px;position: absolute;left:397px;top:397px;background-color: brown;"></div> -->
<!-- <button onclick="downloadPNG()">Save as image (tested on PC browser only)</button> -->

</body>

</html>